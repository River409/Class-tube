<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ClassTube</title>
  <style>
body {
  font-family: Comic sans MS;
  background: #f4f4f4;
  padding: 20px;
}

video {
  width: 300px;
  display: block;
  margin-bottom: 10px;
}

#feed div {
  background: white;
  padding: 10px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
}

#feed img {
  margin-right: 10px;
  border-radius: 50%;
}
[ VIDEO PLAYER ]

Video Title
‚óè ChannelName
[
    "#AA47BD","#7B1FA2","#77919D","#455A65", "#EC417A","#C1175C","#5D6AC0","#0388D2","#00579B","#0098A7","#00897B","#004D40","#68A039","#34691E","#8C6E63","#5D4138","#7D57C1","#512DA7","#EF6C00","#F6511E","#BE360B",];
  </style>
</head>
<body>
<div id="loginBox">
  <h2>Login / Signup</h2>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Login</button>
</div>

<div id="app" style="display:none;">
  <div id="status"></div>
  <input type="file" id="videoFile">
  <input type="text" id="videoTitle" placeholder="Video title">
  <button id="uploadBtn">Upload Video</button>
  <button id="logoutBtn">Logout</button>
  <button id="myChannelBtn">My Channel</button>
  <button id="deleteAccountBtn">Delete Account</button>
  
  <h2>Feed</h2>
  <div id="feed" style="display:flex; flex-wrap:wrap; gap:16px;"></div>
</div>

<div id="profilePage" style="display:none;">
  <h2 id="profileTitle"></h2>
  <img id="profileAvatar" style="border-radius:50%; width:64px;">
  <button id="backBtn">Back to Feed</button>
  <div id="profileVideos" style="display:flex; flex-wrap:wrap; gap:16px; margin-top:8px;"></div>
</div>

  <script>
// -------------------- HELPERS --------------------
const $ = id => document.getElementById(id);

function getDefaultAvatar(username, size = 48) {
  const colors = [
    "#AA47BD","#7B1FA2","#77919D","#455A65", "#EC417A","#C1175C","#5D6AC0","#0388D2","#00579B","#0098A7","#00897B","#004D40","#68A039","#34691E","#8C6E63","#5D4138","#7D57C1","#512DA7","#EF6C00","#F6511E","#BE360B",""];
  const color = colors[username.charCodeAt(0) % colors.length];
  const c = document.createElement("canvas");
  c.width = c.height = size;
  const ctx = c.getContext("2d");
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.arc(size/2,size/2,size/2,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle = "white";
  ctx.font = `${size/2}px Arial`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(username[0] || "?", size/2, size/2);
  return c.toDataURL();
}

function timeAgo(t) {
  const s = Math.floor((Date.now() - t)/1000);
  if(s<60) return `${s}s ago`;
  const m=Math.floor(s/60); if(m<60) return `${m}m ago`;
  const h=Math.floor(m/60); if(h<24) return `${h}h ago`;
  const d=Math.floor(h/24); if(d<30) return `${d}d ago`;
  const mo=Math.floor(d/30); if(mo<12) return `${mo}mo ago`;
  return `${Math.floor(mo/12)}y ago`;
}

// -------------------- STORAGE --------------------
let users = JSON.parse(localStorage.getItem("users")||"{}");
let videos = JSON.parse(localStorage.getItem("videos")||"[]");
let currentUser = null;

function saveUsers(){ localStorage.setItem("users", JSON.stringify(users)); }
function saveVideos(){ localStorage.setItem("videos", JSON.stringify(videos)); }

// -------------------- AUTH --------------------
window.signup = function(){
  const username = $("username").value.trim();
  const password = $("password").value.trim();
  if(!username||!password) return alert("Fill everything");
  if(users[username]) return alert("Username exists");
  users[username]={password,joined:Date.now()};
  saveUsers();
  currentUser=username;
  startApp();
};

window.login = function(){
  const username=$("username").value.trim();
  const password=$("password").value.trim();
  if(!username||!password) return alert("Fill everything");
  if(!users[username]) return alert("Username does not exist");
  if(users[username].password!==password) return alert("Wrong password");
  currentUser=username;
  startApp();
};

window.logout=function(){ 
  currentUser=null; 
  $("app").style.display="none"; 
  $("loginBox").style.display="block"; 
};

// -------------------- START APP --------------------
function startApp(){
  $("loginBox").style.display="none";
  $("app").style.display="block";
  $("status").innerHTML=`<img src="${getDefaultAvatar(currentUser)}" style="border-radius:50%; width:32px; vertical-align:middle;"> Logged in as <b>${currentUser}</b>`;
  renderFeed();
}

// -------------------- VIDEO UPLOAD --------------------
window.uploadVideo=function(){
  const file=$("videoFile").files[0];
  const title=$("videoTitle").value||"Untitled";
  if(!file) return alert("Choose a video");
  const reader=new FileReader();
  reader.onload=function(e){
    videos.unshift({
      id:Date.now(),
      user:currentUser,
      title,
      url:e.target.result,
      likes:[],
      comments:[],
      timestamp:Date.now()
    });
    saveVideos();
    renderFeed();
  };
  reader.readAsDataURL(file);
};

// -------------------- FEED --------------------
function renderFeed(){
  const feedEl=$("feed");
  feedEl.innerHTML="";

  // Sort videos newest first
  const sortedVideos = videos.sort((a,b)=>b.timestamp - a.timestamp);

  sortedVideos.forEach(v=>{
    const card=document.createElement("div");
    card.style.width="320px";
    card.style.border="1px solid #ccc";
    card.style.borderRadius="8px";
    card.style.padding="8px";
    card.style.display="flex";
    card.style.flexDirection="column";

    // Video element
    const videoEl = document.createElement("video");
    videoEl.src=v.url;
    videoEl.controls=true;
    videoEl.width=320;
    videoEl.style.borderRadius="4px";

    // Title
    const titleEl = document.createElement("h4");
    titleEl.style.margin="4px 0";
    titleEl.innerText=v.title;

    // Channel info
    const infoDiv = document.createElement("div");
    infoDiv.style.display="flex";
    infoDiv.style.alignItems="center";
    infoDiv.style.marginBottom="4px";

    const avatar = document.createElement("img");
    avatar.src=getDefaultAvatar(v.user,32);
    avatar.style.borderRadius="50%";
    avatar.style.width="32px";
    avatar.style.marginRight="8px";

    const textDiv = document.createElement("div");
    const channelName=document.createElement("div");
    channelName.style.fontWeight="bold";
    channelName.style.cursor="pointer";
    channelName.style.color="#065fd4";
    channelName.innerText=v.user;
    channelName.onclick = ()=>viewProfile(v.user);

    const timestamp=document.createElement("div");
    timestamp.style.fontSize="12px";
    timestamp.style.color="#555";
    timestamp.innerText = timeAgo(v.timestamp);

    textDiv.appendChild(channelName);
    textDiv.appendChild(timestamp);
    infoDiv.appendChild(avatar);
    infoDiv.appendChild(textDiv);

    // Buttons
    const likeBtn = document.createElement("button");
    likeBtn.innerText = `üëç ${v.likes.length}`;
    likeBtn.onclick = ()=>toggleLike(v.id);

    const commentBtn = document.createElement("button");
    commentBtn.id = `toggleBtn-${v.id}`;
    commentBtn.innerText = `View comments (${v.comments.length})`;
    commentBtn.onclick = ()=>toggleComments(v.id);

    // Comments box
    const commentsBox = document.createElement("div");
    commentsBox.id = `comments-${v.id}`;
    commentsBox.style.display="none";
    commentsBox.style.marginTop="4px";
    commentsBox.style.fontSize="14px";

    const commentInput = document.createElement("input");
    commentInput.type="text";
    commentInput.placeholder="Add comment";

    const postBtn=document.createElement("button");
    postBtn.innerText="Post";
    postBtn.onclick = function() {
      addComment(v.id, commentInput.value);
      commentInput.value = "";
    };

    commentsBox.appendChild(commentInput);
    commentsBox.appendChild(postBtn);

    // Assemble card
    card.appendChild(videoEl);
    card.appendChild(titleEl);
    card.appendChild(infoDiv);
    card.appendChild(likeBtn);
    card.appendChild(commentBtn);
    card.appendChild(commentsBox);

    feedEl.appendChild(card);
  });
}

// -------------------- COMMENTS --------------------
window.addComment=function(id,text){
  if(!text) return;
  const v=videos.find(v=>v.id===id);
  v.comments.push({user:currentUser,text,timestamp:Date.now()});
  saveVideos(); renderFeed();
};

window.toggleComments=function(id){
  const box=$("comments-"+id);
  const btn=$("toggleBtn-"+id);
  const v=videos.find(v=>v.id===id);
  if(box.style.display==="none"){
    box.style.display="block";
    // Render existing comments
    box.innerHTML = "";
    const commentInput = document.createElement("input");
    commentInput.type="text";
    commentInput.placeholder="Add comment";
    const postBtn = document.createElement("button");
    postBtn.innerText="Post";
    postBtn.onclick = function(){
      addComment(v.id, commentInput.value);
      commentInput.value = "";
    };
    box.appendChild(commentInput);
    box.appendChild(postBtn);

    v.comments.forEach(c=>{
      const cDiv = document.createElement("div");
      cDiv.innerHTML = `<b style="cursor:pointer; color:#065fd4;" onclick="viewProfile('${c.user}')">${c.user}</b>: ${c.text}`;
      box.appendChild(cDiv);
    });

    btn.innerText="Close comments";
  } else {
    box.style.display="none";
    btn.innerText=`View comments (${v.comments.length})`;
  }
};

// -------------------- PROFILE --------------------
window.viewProfile=function(user){
  $("feed").style.display="none";
  $("profilePage").style.display="block";
  $("profileTitle").innerText=user+"'s Channel";
  $("profileAvatar").src=getDefaultAvatar(user,64);
  $("profileVideos").innerHTML="";
  videos.filter(v=>v.user===user).forEach(v=>{
    const vid=document.createElement("video");
    vid.src=v.url; vid.controls=true; vid.width=320;
    $("profileVideos").appendChild(vid);
  });
};

window.closeProfile=function(){
  $("profilePage").style.display="none";
  $("feed").style.display="block";
};

// -------------------- DELETE ACCOUNT --------------------
window.deleteAccount=function(){
  if(!confirm("Delete account permanently?")) return;
  videos=videos.filter(v=>v.user!==currentUser);
  delete users[currentUser];
  saveVideos(); saveUsers(); logout();
};

// -------------------- BUTTONS --------------------
$("signupBtn").onclick=signup;
$("loginBtn").onclick=login;
$("logoutBtn").onclick=logout;
$("uploadBtn").onclick=uploadVideo;
$("myChannelBtn").onclick=()=>viewProfile(currentUser);
$("backBtn").onclick=closeProfile;
$("deleteAccountBtn").onclick=deleteAccount;

  </script>
</body>
</html>
